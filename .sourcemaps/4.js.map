{"version":3,"sources":["../../src/pages/court-search/court-search.module.ts","../../src/pages/court-search/court-search.ts"],"names":[],"mappings":"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","file":"4.js","sourcesContent":["import { NgModule } from '@angular/core';\nimport { IonicPageModule } from 'ionic-angular';\nimport { CourtSearchPage } from './court-search';\n\n@NgModule({\n  declarations: [\n    CourtSearchPage,\n  ],\n  imports: [\n    IonicPageModule.forChild(CourtSearchPage),\n  ],\n  exports: [\n    CourtSearchPage\n  ]\n})\nexport class CourtSearchPageModule {}\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/court-search/court-search.module.ts","import { Component, NgZone } from '@angular/core';\nimport { IonicPage, NavController, NavParams, Events, AlertController, ViewController } from 'ionic-angular';\nimport { FormControl } from '@angular/forms';\nimport { CourtDataService } from '../../services/courtDataService.service';\n\n\n@IonicPage()\n@Component({\n  selector: 'page-court-search',\n  templateUrl: 'court-search.html',\n})\nexport class CourtSearchPage {\n\n  // The term by which we query the db\n  searchTerm: string = ''\n  // searchControl so that we can see when the searchterm changes\n  searchControl: FormControl;\n  // the array which holds our search results\n  searchResults: Array<any>;\n  // Our User's homecourts for quick access to their regular courts\n  suggestedCourts: Array<any>;\n\n  // Variable header and title so that page can be used in different ways\n  title: string;\n  header: string;\n  subHeader: string;\n\n  // Whether or not we are loading\n  loading: boolean = true;\n\n  constructor(public navCtrl: NavController,\n              public params: NavParams,\n              public courtDataService: CourtDataService,\n              public events: Events,\n              public zone: NgZone,\n              public alertCtrl: AlertController,\n              public viewCtrl: ViewController\n  ) {\n    this.searchControl = new FormControl;\n    // Get user's recently visited courts as reference\n    this.getSuggestedCourts();\n    if(params.get('role') === 'homecourts'){\n      this.title = 'Court Search';\n      this.header = 'Where do you regularly play?'\n      this.subHeader = 'Search to add to your collection of homecourts'\n    }\n    else if(params.get('role') === 'inviteFriends'){\n      this.title = 'Invite Friends'\n      this.header = 'Where do you wish to play?'\n    }\n  }\n\n  ionViewDidLoad() {\n    // This observable controls the moment at which we ask the server for friends to add\n    this.searchControl.valueChanges.debounceTime(700).subscribe(search =>{\n      this.loading = true;\n      if (search === '') {\n        this.searchResults = this.suggestedCourts;\n        this.loading = false;\n        return;\n      }\n      this.courtDataService.getCourtsByName(this.searchTerm).subscribe(\n        res => {\n          this.searchResults = res.json()\n          this.loading = false;\n        },\n        err => { console.log('error getUsersByName() on friends page ' + err) }\n      );\n    });\n  }\n\n  // Post: suggested courts and search results set user's recently visited courts\n  //       Sorted to put homecourts first\n  public getSuggestedCourts(){\n\n    let courts: Array<string> = [];\n    courts.concat(JSON.parse(window.localStorage.getItem('currentUser')).homecourts)\n    // Loop thru user's recent checkIns, if not already in courts push to courts\n    for(let checkIn of JSON.parse(window.localStorage.getItem('currentUser')).checkIns)\n      if(courts.indexOf(checkIn.court_id) === -1) courts.push(checkIn.court_id)\n    if(courts.length === 0){\n      this.zone.run(() => { this.loading = false })\n      return;\n    }\n\n    this.courtDataService.getCourtsById(courts).subscribe(\n      res => {\n        // sort putting homecourts up top\n        this.suggestedCourts = res.json().sort((a, b) => {\n          if(this.isHomecourt(a._id) && !this.isHomecourt(b._id)) return -1;\n          if(!this.isHomecourt(a._id) && this.isHomecourt(b._id)) return 1;\n          return 0;\n        });\n        this.searchResults = this.suggestedCourts;\n        this.loading = false;\n      },\n      err => this.courtDataService.notify('ERROR', err)\n    )\n  }\n\n  // Returns: true if court_id is one of the current user's homecourts, false otherwise\n  // Param: id of court to be checked\n  public isHomecourt(court_id: string){\n    if(JSON.parse(window.localStorage.getItem('currentUser')).homecourts.indexOf(court_id) > -1)\n      return true;\n    return false;\n  }\n\n\n  // Post: Move on to select friends portion of invite friends loop\n  // Param: court to be passed to next page\n  public courtClicked(court: any){\n\n    if(this.params.get('role') === 'inviteFriends')\n      this.navCtrl.push('SelectFriendsPage', { court: court})\n\n    else if(this.params.get('role') === 'homecourts'){\n      // Confirm homecourt add\n      let alert = this.alertCtrl.create({\n         title: 'Add Homecourt',\n         subTitle: 'Confirm to add ' + court.name + ' to your collection of homecourts.',\n         buttons: [\n           { text: 'Cancel',\n             role: 'cancel'\n           },\n           { text: 'Confirm',\n             handler: () =>{\n               // Dismiss alert, pop court search, spark response behavior\n               alert.dismiss().then(() => {\n                 this.viewCtrl.dismiss().then(() => {\n                   this.events.publish('newHomecourt', court);\n                 })\n               })\n               return false;\n             }\n           }\n         ]\n       })\n       alert.present()\n    }\n  }\n\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/court-search/court-search.ts"],"sourceRoot":""}