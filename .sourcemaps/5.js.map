{"version":3,"sources":["../../src/pages/court-search/court-search.module.ts","../../src/pages/court-search/court-search.ts"],"names":[],"mappings":"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","file":"5.js","sourcesContent":["import { NgModule } from '@angular/core';\nimport { IonicPageModule } from 'ionic-angular';\nimport { CourtSearchPage } from './court-search';\n\n@NgModule({\n  declarations: [\n    CourtSearchPage,\n  ],\n  imports: [\n    IonicPageModule.forChild(CourtSearchPage),\n  ],\n  exports: [\n    CourtSearchPage\n  ]\n})\nexport class CourtSearchPageModule {}\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/court-search/court-search.module.ts","import { Component, NgZone } from '@angular/core';\nimport { IonicPage, NavController, NavParams, Events } from 'ionic-angular';\nimport { FormControl } from '@angular/forms';\nimport { CourtDataService } from '../../services/courtDataService.service';\n\n\n@IonicPage()\n@Component({\n  selector: 'page-court-search',\n  templateUrl: 'court-search.html',\n})\nexport class CourtSearchPage {\n\n  // The term by which we query the db\n  searchTerm: string = ''\n  // searchControl so that we can see when the searchterm changes\n  searchControl: FormControl;\n  // the array which holds our search results\n  searchResults: Array<any>;\n  // Our User's homecourts for quick access to their regular courts\n  suggestedCourts: Array<any>;\n\n  // Variable header and title so that page can be used in different ways\n  title: string;\n  header: string;\n  subHeader: string;\n\n  // Whether or not we are loading\n  loading: boolean = true;\n\n  constructor(public navCtrl: NavController,\n              public params: NavParams,\n              public courtDataService: CourtDataService,\n              public events: Events,\n              public zone: NgZone\n  ) {\n    this.searchControl = new FormControl;\n    // Get user's recently visited courts as reference\n    this.getSuggestedCourts();\n    if(params.get('role') === 'homecourts'){\n      this.title = 'Court Search';\n      this.header = 'Where do you regularly play?'\n      this.subHeader = 'You can also add Homecourts from the map by holding the marker icon of the court you wish to add.'\n    }\n    else if(params.get('role') === 'inviteFriends'){\n      this.title = 'Invite Friends'\n      this.header = 'Where do you wish to play?'\n    }\n  }\n\n  ionViewDidLoad() {\n    // This observable controls the moment at which we ask the server for friends to add\n    this.searchControl.valueChanges.debounceTime(700).subscribe(search =>{\n      this.loading = true;\n      if (search === '') {\n        this.searchResults = this.suggestedCourts;\n        this.loading = false;\n        return;\n      }\n      this.courtDataService.getCourtsByName(this.searchTerm).subscribe(\n        res => {\n          this.searchResults = res.json()\n          this.loading = false;\n        },\n        err => { console.log('error getUsersByName() on friends page ' + err) }\n      );\n    });\n  }\n\n  // Post: suggested courts and search results set user's recently visited courts\n  //       Sorted to put homecourts first\n  public getSuggestedCourts(){\n\n    let courts: Array<string> = [];\n    courts.concat(JSON.parse(window.localStorage.getItem('currentUser')).homecourts)\n    // Loop thru user's recent checkIns, if not already in courts push to courts\n    for(let checkIn of JSON.parse(window.localStorage.getItem('currentUser')).checkIns)\n      if(courts.indexOf(checkIn.court_id) === -1) courts.push(checkIn.court_id)\n    if(courts.length === 0){\n      this.zone.run(() => { this.loading = false })\n      return;\n    }\n\n    this.courtDataService.getCourtsById(courts).subscribe(\n      res => {\n        // sort putting homecourts up top\n        this.suggestedCourts = res.json().sort((a, b) => {\n          if(this.isHomecourt(a._id) && !this.isHomecourt(b._id)) return -1;\n          if(!this.isHomecourt(a._id) && this.isHomecourt(b._id)) return 1;\n          return 0;\n        });\n        this.searchResults = this.suggestedCourts;\n        this.loading = false;\n      },\n      err => this.courtDataService.notify('ERROR', err)\n    )\n  }\n\n  // Returns: true if court_id is one of the current user's homecourts, false otherwise\n  // Param: id of court to be checked\n  public isHomecourt(court_id: string){\n    if(JSON.parse(window.localStorage.getItem('currentUser')).homecourts.indexOf(court_id) > -1)\n      return true;\n    return false;\n  }\n\n\n  // Post: Move on to select friends portion of invite friends loop\n  // Param: court to be passed to next page\n  public courtClicked(court: any){\n    if(this.params.get('role') === 'inviteFriends')\n      this.navCtrl.push('SelectFriendsPage', { court: court})\n\n    else if(this.params.get('role') === 'homecourts'){\n      // Tell homecourt display to refresh with new court\n      this.events.publish('newHomecourt', court);\n      this.navCtrl.pop()\n    }\n  }\n\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/court-search/court-search.ts"],"sourceRoot":""}